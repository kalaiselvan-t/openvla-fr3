# MoveIt Servo Configuration for Franka FR3 in Gazebo
# Based on MoveIt2 best practices (2024/2025)
# Format: Flat YAML (no namespace wrapper needed - handled by launch file)

## Core Configuration
use_gazebo: true
is_primary_planning_scene_monitor: false

## Robot Configuration
move_group_name: "fr3_arm"
planning_frame: "fr3_link0"
ee_frame_name: "fr3_hand_tcp"
robot_link_command_frame: "fr3_link0"  # Frame that incoming twist commands are validated against

## Command Input/Output Topics
cartesian_command_in_topic: "/servo_node/delta_twist_cmds"
joint_command_in_topic: "/servo_node/delta_joint_cmds"
command_out_topic: "/arm_controller/joint_trajectory"
status_topic: "/servo_node/status"

## Command Type and Scaling
command_in_type: "unitless"

## Control Loop Timing
publish_period: 0.034

## Command Timeout
incoming_command_timeout: 0.5

## Velocity Scaling
scale:
  linear: 0.4
  rotational: 0.8
  joint: 0.5

## Smoothing
use_smoothing: true
smoothing_filter_plugin_name: "online_signal_smoothing::ButterworthFilterPlugin"

## Joint Limits
override_velocity_scaling_factor: 0.3
halt_all_joints_in_joint_mode: true
halt_all_joints_in_cartesian_mode: true
joint_limit_margins: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]

## Collision Checking
check_collisions: true
collision_check_rate: 10.0
self_collision_proximity_threshold: 0.01
scene_collision_proximity_threshold: 0.02
collision_distance_safety_factor: 1000.0
min_allowable_collision_distance: 0.01

## Singularity Avoidance
lower_singularity_threshold: 17.0
hard_stop_singularity_threshold: 30.0
leaving_singularity_threshold_multiplier: 2.0
singularity_step_scale: 0.01

## Output Configuration
command_out_type: "trajectory_msgs/JointTrajectory"
publish_joint_positions: true
publish_joint_velocities: true
publish_joint_accelerations: false

## Planning Scene Monitor
monitored_planning_scene_topic: "/planning_scene"
joint_topic: "/joint_states"

## Additional Safety
check_octomap_collisions: false
